# Usamos una imagen base de Linux (Ubuntu 22.04)
FROM ubuntu:22.04

# Variables de entorno para evitar preguntas en la instalaci칩n y mejorar logs en Render
ENV DEBIAN_FRONTEND=noninteractive
ENV PYTHONUNBUFFERED=1

# Actualizamos e instalamos dependencias del sistema y MPI
RUN apt-get update && apt-get install -y \
    build-essential \
    openmpi-bin \
    libopenmpi-dev \
    git \
    python3 \
    python3-pip \
    && rm -rf /var/lib/apt/lists/*

# Establecemos el directorio de trabajo
WORKDIR /app

# Instalamos las librer칤as de Python
# Nota: --no-cache-dir reduce el tama침o de la imagen final
RUN pip3 install --no-cache-dir streamlit matplotlib numpy plotly

# 游 PASO CR칈TICO: Copiar los archivos del proyecto 游
# Copiamos todo el contenido de tu repositorio al contenedor
COPY . .

# 游 COMPILACI칍N MPI 游
# Si tienes un Makefile, esto compilar치 tu c칩digo C autom치ticamente.
# El 'if' evita que falle si por alguna raz칩n no hay Makefile.
RUN if [ -f Makefile ]; then make; fi

# Koyeb inyectar치 la variable PORT (por defecto 8000)
EXPOSE 8000

# Usamos sh -c para capturar la variable de entorno
CMD sh -c "streamlit run dashboard.py --server.port=${PORT:-8000} --server.address=0.0.0.0"